
## Markdo 程序架构

```
f:\prog\
├── run.py              # 入口文件
├── main.py             # 主程序 (78.6KB, 2100+ 行)
├── pyqt_webview.py     # WebView 组件
├── build_exe.py        # PyInstaller 打包脚本
├── setup.iss           # Inno Setup 安装程序配置
├── 启动编辑器.bat       # Windows 快捷启动
└── .gitignore          # Git 忽略规则
```

---

### 核心类结构 (main.py)

```
┌─────────────────────────────────────────────────────────────┐
│                      MarkdownEditor                          │
│                    (QMainWindow 主窗口)                       │
├─────────────────────────────────────────────────────────────┤
│ • 多标签页管理 (tabs{})                                       │
│ • 菜单栏 (文件/编辑/帮助)                                      │
│ • 工具栏 (新建/打开/保存/Markdown工具)                         │
│ • 快捷键系统 (Ctrl+B/I/K/1~6等)                               │
│ • 主题切换 (黑夜/白天)                                        │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ MarkdownTextEdit│  │ QWebEngineView  │  │FloatingMarkdown │
│   (编辑器)       │  │   (预览区)       │  │   Toolbar       │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ • Tab键触发      │  │ • HTML渲染      │  │ • 分页标签       │
│ • 列表自动续接   │  │ • MathJax公式   │  │   - 基础(标题格式)│
│ • 语法高亮       │  │ • CSS样式       │  │   - 列表(引用)   │
└─────────────────┘  └─────────────────┘  │   - 插入(链接等) │
                                          │   - LaTeX(公式)  │
                                          └─────────────────┘
```

---

### 辅助类

| 类名 | 功能 |
|------|------|
| **Theme** | 主题系统 (DARK/LIGHT)，生成 Qt 样式表 |
| **SettingsDialog** | 设置窗口 (主题切换、工具栏配置) |
| **MarkdownHighlighter** | Markdown 语法高亮 (QSyntaxHighlighter) |
| **MarkdownTextEdit** | 自定义编辑器 (支持 Tab 键、列表自动续接) |
| **FloatingMarkdownToolbar** | 悬浮工具栏 (4分页：基础/列表/插入/LaTeX) |

---

### 数据流

```
用户输入 Markdown
       │
       ▼
┌──────────────────┐
│ MarkdownTextEdit │ ─── 语法高亮 (MarkdownHighlighter)
└────────┬─────────┘
         │ textChanged 信号 (500ms 防抖)
         ▼
┌──────────────────┐
│ markdown_to_html │ ─── 公式保护 → Markdown解析 → 公式恢复
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ wrap_html_with_  │ ─── CSS样式 + MathJax配置
│     style        │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ QWebEngineView   │ ─── 实时预览 (setHtml)
└──────────────────┘
```

---

### 技术栈

- **GUI**: PyQt6
- **预览**: QWebEngineView + MathJax 3
- **Markdown**: python-markdown + pymdownx 扩展
- **打包**: PyInstaller + Inno Setup