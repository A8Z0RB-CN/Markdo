# Markdo 打包指南

## 📦 打包方法

### 方法一：使用 cx_Freeze 打包（推荐）

这是最简单快捷的打包方法，适合大多数用户。

#### 步骤 1：安装依赖

确保已安装所有必要的依赖：

```batch
pip install -r requirements.txt
pip install cx_Freeze
```

#### 步骤 2：执行打包

**方式 A：一键打包（推荐）**

双击运行或命令行执行：

```batch
build_cx_clean.bat
```

这个脚本会自动：
1. ✅ 清理废弃文件
2. ✅ 检查并生成图标文件
3. ✅ 使用 cx_Freeze 打包
4. ✅ 清理打包后的多余文件
5. ✅ 显示打包体积

**方式 B：手动打包**

```batch
python setup_cx.py build
```

#### 步骤 3：查找打包结果

打包完成后，可执行文件位于：

```
build\exe.win-amd64-3.13\Markdo.exe
```

整个目录可以分发，用户直接运行 `Markdo.exe` 即可。

---

### 方法二：创建安装程序（可选）

如果需要创建专业的安装程序，可以使用 Inno Setup。

#### 前置条件

1. 下载并安装 [Inno Setup](https://jrsoftware.org/isdl.php)
2. 完成 cx_Freeze 打包（方法一）

#### 执行步骤

**方式 A：一键打包+安装程序**

```batch
build_installer.bat
```

**方式 B：手动编译**

1. 右键点击 `setup_cx.iss` 文件
2. 选择 "Compile"
3. 或使用命令行：

```batch
"C:\Program Files (x86)\Inno Setup 6\ISCC.exe" setup_cx.iss
```

安装程序将生成在：

```
installer_cx\Markdo_Setup_CX_1.0.3.exe
```

---

## 📋 打包前检查清单

- [ ] 已安装所有依赖：`pip install -r requirements.txt`
- [ ] 已安装打包工具：`pip install cx_Freeze`
- [ ] `Markdo.ico` 图标文件存在（会自动生成）
- [ ] 所有资源文件存在：
  - `markdo-icon.png`
  - `register_file_association.bat`
  - `unregister_file_association.bat`
  - `FILE_ASSOCIATION_README.md`

---

## 🔍 验证打包结果

打包完成后，运行检查脚本：

```batch
check_build.bat
```

这会检查：
- ✅ 可执行文件是否存在
- ✅ 资源文件是否包含
- ✅ 核心库是否包含
- ✅ 打包体积大小

---

## 📊 打包体积对比

| 打包方式 | 预计体积 | 优点 | 缺点 |
|---------|---------|------|------|
| cx_Freeze | ~550 MB | 简单易用，兼容性好 | 体积较大 |

---

## ⚠️ 常见问题

### 1. cx_Freeze 打包失败

**错误**：`ModuleNotFoundError: No module named 'xxx'`

**解决**：
- 检查 `setup_cx.py` 中的 `packages` 列表
- 确保已安装所有依赖：`pip install -r requirements.txt`

### 2. 打包后程序无法运行

**检查**：
- 运行 `check_build.bat` 检查打包文件
- 确保所有 DLL 文件都在同一目录
- 检查是否有缺失的模块（查看错误信息）

---

## 📁 打包输出目录结构

```
build\exe.win-amd64-3.13\
├── Markdo.exe                    # 主程序
├── markdo-icon.png               # 图标
├── register_file_association.bat # 文件关联脚本
├── unregister_file_association.bat
├── FILE_ASSOCIATION_README.md
├── python3.dll                   # Python 运行时
├── lib\                          # 库文件目录
│   ├── PyQt6\                   # PyQt6 库
│   ├── markdown\                # Markdown 库
│   ├── pymdownx\                # pymdownx 扩展
│   ├── pygments\                # 代码高亮库
│   └── ...
└── ...
```

---

## 🚀 快速开始

**最简单的打包方式**：

1. 打开命令提示符（CMD）或 PowerShell
2. 进入项目目录：`cd f:\prog`
3. 运行：`build_cx_clean.bat`
4. 等待打包完成（可能需要几分钟）
5. 在 `build\exe.win-amd64-3.13\` 目录找到 `Markdo.exe`

---

## 📝 注意事项

1. **首次打包**可能需要较长时间（5-10分钟），请耐心等待
2. **打包体积**较大是正常的，因为包含了完整的 Python 运行时和 Qt 库
3. **分发时**需要将整个 `build\exe.win-amd64-3.13\` 目录一起分发
4. **测试**打包后的程序，确保所有功能正常

---

## 💡 提示

- 使用 `build_cx_clean.bat` 会自动清理废弃文件，减小打包体积
- 打包前建议先测试程序：`python run.py`
- 如果只需要快速测试，可以直接运行 `python main.py`

